apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-custom-ca
  namespace: argocd
data:
  gitlab.crt: |
    -----BEGIN CERTIFICATE-----
    MIIFgDCCA2igAwIBAgIUBvAV8AS4in86WfovtKl2UnqNQJ4wDQYJKoZIhvcNAQEN
    BQAwPjEPMA0GA1UEChMGZ2l0bGFiMQ8wDQYDVQQLEwZnaXRsYWIxGjAYBgNVBAMT
    EUdpdExhYiBIZWxtIENoYXJ0MB4XDTI1MDMyNTA5MzQwMFoXDTI2MDMyNTA5MzQw
    MFowFjEUMBIGA1UEAxMLaG9zdHMubG9jYWwwggIiMA0GCSqGSIb3DQEBAQUAA4IC
    DwAwggIKAoICAQCqoF9pIv8FwI2/K/4TeGCCRQX4D3b+fFjhYduSNto/RAUAa8ww
    PsR9wS1Wcixx1vXcHMfhrQ6VvGjk2UvqKnlrupMdXnLpb06JaxFnN9xaAiCfBH66
    ukyIWti1nKQLgUdzZHWZLLZgwB3I2URLRFpucCV3n1uY5vj4xwy0ckeIfzNF5WVZ
    NQdAW1B5ICe1jPXbzJRyTQOIpqgtvf36J8VkXgsu/dd3tvGhInmLHrHEJmTANjCe
    WGlcW4roftni7wKtgoHvXWjOZXy3B2HYgt1j+lifJZTPl6ZtpFL7pDXWfrOX5j51
    9zA0spENGPqmEjgpYTVRGPL3HwrKyD1VBidbPKgPu9Q+0ih+nHD8qr77zb8Xacar
    d0mcytZ0pw6/8PzvYw9GIJSt9QSd1BNZ2KUEh+r3Q3El1/Q6FOWc2fyjow07ZuCJ
    NBa6efwXhWQvREeFVsxoFmpWIdnn37myyHwtH6/Dar62teSHME1HXO1V1DTk9IaA
    l9Dfj8sK73YSAtnZbXUypH23+2zznQT6JjnJ4yywinn5wu+dZrGFcibRmcfPQpzZ
    9+swV7PjCamVPYuSOEQgyMZ12dee2p5Bmbq+mlM73iIcbH2GK9x32xBeSkXtqQ+t
    zam2HWxURzVEgcvD56AyB5j/vUvQs+T8cJGGxI2DWEiCsCLIv3CLJWBsZQIDAQAB
    o4GdMIGaMA4GA1UdDwEB/wQEAwICpDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNV
    HRMBAf8EAjAAMB0GA1UdDgQWBBR4aVvGL0po3QhRwmgpX7S6+u175TAfBgNVHSME
    GDAWgBTc07mIjwJ0sUJLxqCjMXwaQBJZ7TAlBgNVHREEHjAcggtob3N0cy5sb2Nh
    bIINKi5ob3N0cy5sb2NhbDANBgkqhkiG9w0BAQ0FAAOCAgEAA0A3Hj90PJy4sSls
    EqUOnvpsjdCSyNbLMDfRzghB53IF+xDOMK4AEL4OmNHDR0Fe7WOw4F5DojWhg+51
    9DBI+PRhkXnnRtK4b+SJSaFTf6slMAu5MhU470ha/xe/hGTvfiYMrBngwKjNarBp
    GdK5mhpUS1nHFbdX0LWO3ortDFeScCDqNB501g+mttiPSVkdqDCE1rP8msN9A2xK
    ULNuDqXGc5xg7hNQa9v8ghfVufmhlUqKOiDfnbLJPcvLJBJmTc84QzEa9aaDgAkt
    /5tK9aRCwene7edfE2rTOspG/zOtflCZLIkrY97l2jmD4Ft57WJAWcHHgLBYArPW
    AekSNT27YZFyRX9tauae8C4Jsu1cyvkP7W88kfe8IEH7cgNyKOTx/L4AXjRCJcM7
    OaEO2B3kyhh4L3bDB+BAhro+HABIio3pOC383usDey1EYOpIiY9I3z0dRB3lVc+6
    o0B0GbSTRwaL6sNPGTDVjPIpRrY2IbUiDW2GdiPp/ZG2Rs/yrtAq/+CA0Q1Sz2Es
    1krmqVuQFal+A6jTZpLbXr3CiPmc8PjhsZur7R+YAjKrBDXUSE30vrrn9V0Ymopu
    WJes+ivnApbaexv4+dyZXC74o7UkLgKUVevFOdpMwxdEfSLzqsdqxmagRQhSjFF7
    xWe/Krmy0n3wl7GW0g6nxFFMQ/0=
    -----END CERTIFICATE-----
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: argocd-repo-server
  namespace: argocd
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-repo-server
  template:
    metadata:
      labels:
        app.kubernetes.io/name: argocd-repo-server
    spec:
      containers:
      - name: argocd-repo-server
        volumeMounts:
        - name: gitlab-ca
          mountPath: /etc/ssl/certs/gitlab.crt
          subPath: gitlab.crt
      volumes:
      - name: gitlab-ca
        configMap:
          name: argocd-custom-ca